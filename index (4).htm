<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HADIQATUL A'DOL Members</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root{
      --bg: #f4f6f9;
      --card: #ffffff;
      --text: #222;
      --accent: #2b8cff;
      --muted: #6b6b6b;
      --success: #2aa74f;
      --danger: #e64545;
      --shadow: 0 6px 20px rgba(16,24,40,0.08);
    }
    body.dark{ --bg:#0f1724; --card:#0b1220; --text:#e6eef8; --accent:#4aa3ff; --muted:#9aa8bf; --shadow:0 6px 20px rgba(0,0,0,0.6); }
    body.green{ --accent:#16a34a; }
    body.purple{ --accent:#7c3aed; }
    body.blue{ --accent:#2b8cff; }

    *{box-sizing:border-box}
    body{ font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif; margin:0; background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; transition:background .2s, color .2s; }
    header{ display:flex; align-items:center; justify-content:space-between; padding:14px 18px; background:var(--accent); color:#fff; position:sticky; top:0; z-index:80; box-shadow:var(--shadow); }
    header h1{ margin:0; font-size:18px; font-weight:600; }
    .menu{ font-size:20px; cursor:pointer; user-select:none; padding:6px; border-radius:6px; }
    .menu:hover{ background:rgba(255,255,255,0.06); }
    .menu-options{ display:none; position:absolute; right:16px; top:58px; background:var(--card); color:var(--text); padding:12px; border-radius:10px; box-shadow:0 12px 40px rgba(2,6,23,0.12); z-index:90; width:260px; }
    .menu-options .theme-title{ font-weight:600; margin:4px 0 8px; }
    .swatches{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px; }
    .swatch{ width:34px; height:34px; border-radius:8px; cursor:pointer; border:2px solid rgba(0,0,0,0.06); box-shadow:0 4px 12px rgba(2,6,23,0.06); }

    .container{ max-width:980px; margin:20px auto; padding:16px; }
    .controls{ display:flex; gap:12px; align-items:center; margin-bottom:12px; flex-wrap:wrap; }
    .search-box{ display:flex; gap:8px; align-items:center; flex:1; }
    .search-box input{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(2,6,23,0.08); }
    .btn{ padding:9px 12px; border:none; border-radius:10px; cursor:pointer; background:var(--accent); color:#fff; box-shadow:0 6px 18px rgba(43,140,255,0.12); }
    .btn.secondary{ background:#6b7280; box-shadow:none; }

    h2{ color:var(--accent); margin:10px 0; font-size:18px; }

    .list{ margin-top:8px; display:flex; flex-direction:column; gap:10px; }
    .card{ background:var(--card); border-radius:12px; padding:14px; box-shadow:var(--shadow); transition:transform .12s, box-shadow .12s; cursor:pointer; display:flex; justify-content:space-between; align-items:center; }
    .card:hover{ transform:translateY(-4px); box-shadow:0 14px 32px rgba(2,6,23,0.08); }
    .meta{ display:flex; gap:12px; align-items:center; }
    .meta .id{ font-weight:700; letter-spacing:0.6px; }
    .meta small{ color:var(--muted); display:block; }
    .card .actions{ display:flex; gap:8px; align-items:center; }
    .fav-btn.added{ background:#f6b100; color:#000; }

    /* details slide */
    .details{ overflow:hidden; max-height:0; transition:max-height .28s ease, opacity .18s; opacity:0; border-left:4px solid var(--accent); border-radius:8px; margin-top:10px; padding:0 12px; background:rgba(2,6,23,0.02); }
    .details.open{ max-height:420px; opacity:1; padding:12px; }
    .details p{ margin:8px 0; color:var(--muted); }

    /* favorites / dashboard / tracker sections */
    #favoritesSection, #dashboard, #salahTracker{ display:none; animation:fadeIn .18s ease; }
    @keyframes fadeIn{ from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none} }

    /* login modal */
    #loginModal{ display:none; position:fixed; inset:0; background:rgba(2,6,23,0.45); justify-content:center; align-items:center; z-index:120; }
    #loginBox{ width:360px; max-width:92%; background:var(--card); color:var(--text); padding:18px; border-radius:12px; box-shadow:0 18px 40px rgba(2,6,23,0.16); }
    #loginBox h3{ margin:0 0 10px 0; font-size:16px; }
    #loginBox input{ width:100%; padding:10px; margin:8px 0; border-radius:8px; border:1px solid rgba(2,6,23,0.06); }

    /* tracker table */
    .tracker-wrap{ overflow:auto; border-radius:10px; box-shadow:var(--shadow); background:var(--card); padding:10px; }
    table{ border-collapse:collapse; width:100%; min-width:720px; }
    th, td{ border:1px solid rgba(2,6,23,0.06); padding:8px; text-align:center; font-size:14px; }
    th{ background:rgba(2,6,23,0.03); color:var(--muted); font-weight:600; }
    .cell-actions button{ margin:3px; padding:6px 8px; border-radius:8px; border:none; cursor:pointer; }
    .cell-actions .on{ background:var(--success); color:#fff; }
    .cell-actions .off{ background:var(--danger); color:#fff; }

    .summary{ margin-top:10px; font-weight:700; color:var(--muted); }
    footer{ text-align:center; padding:18px; margin-top:28px; color:var(--muted); }

    @media (max-width:640px){
      .card{ flex-direction:column; align-items:flex-start; gap:8px; }
      .menu-options{ right:8px; left:8px; width:auto; top:70px; }
      .tracker-wrap{ overflow:auto; }
    }
  </style>
</head>
<body>
  <header>
    <h1>HADIQATUL A'DOL Members</h1>
    <div style="position:relative;">
      <div class="menu" id="menuToggle" onclick="toggleMenu()">â˜°</div>
      <div class="menu-options" id="menuOptions" aria-hidden="true" role="menu">
        <div class="theme-title">Theme</div>
        <div class="swatches" aria-hidden="false">
          <div class="swatch" title="Light" style="background:#f4f6f9" onclick="setTheme('light')"></div>
          <div class="swatch" title="Dark" style="background:#0f1724" onclick="setTheme('dark')"></div>
          <div class="swatch" title="Green" style="background:#16a34a" onclick="setTheme('green')"></div>
          <div class="swatch" title="Purple" style="background:#7c3aed" onclick="setTheme('purple')"></div>
          <div class="swatch" title="Blue" style="background:#2b8cff" onclick="setTheme('blue')"></div>
        </div>
        <button onclick="onTrackerClick()">Salah Tracker</button>
        <button onclick="showFavorites()">View Favorites</button>
        <button id="loginBtn" onclick="openLogin()">Login</button>
        <button id="dashboardBtn" style="display:none;" onclick="openDashboard()">Dashboard</button>
      </div>
    </div>
  </header>

  <main class="container" id="mainContent">
    <div class="controls">
      <div class="search-box">
        <input id="searchInput" placeholder="Search by ID or name (type to filter)">
        <button class="btn" onclick="performSearch()">Search</button>
      </div>
      <!-- Export All PDFs removed as requested -->
    </div>

    <section>
      <h2>Admin</h2>
      <div class="list" id="adminList">
        <div class="card" data-id="HA-25X9Q7-01" data-name="Md Amir Hamza">
          <div class="meta">
            <div class="id">HA-25X9Q7-01</div>
            <div><small>Md Amir Hamza (Admin)</small></div>
          </div>
          <div class="actions">
            <button class="btn fav-btn" data-id="HA-25X9Q7-01" onclick="toggleFavorite('HA-25X9Q7-01', event)">Favorite</button>
            <button class="btn" onclick="copyToClipboard('HA-25X9Q7-01', event)">Copy</button>
            <button class="btn" onclick="downloadPDF('HA-25X9Q7-01', event)">PDF</button>
          </div>
        </div>
      </div>
    </section>

    <section>
      <h2>Members</h2>
      <div class="list" id="memberList">
        <div class="card" data-id="HA-25K4M2-02" data-name="Munaim Ahmed Ihfaz">
          <div class="meta">
            <div class="id">HA-25K4M2-02</div>
            <div><small>Munaim Ahmed Ihfaz</small></div>
          </div>
          <div class="actions">
            <button class="btn fav-btn" data-id="HA-25K4M2-02" onclick="toggleFavorite('HA-25K4M2-02', event)">Favorite</button>
            <button class="btn" onclick="copyToClipboard('HA-25K4M2-02', event)">Copy</button>
            <button class="btn" onclick="downloadPDF('HA-25K4M2-02', event)">PDF</button>
          </div>
        </div>

        <div class="card" data-id="HA-25Z7L8-03" data-name="Minhaz Uddin Kadir">
          <div class="meta">
            <div class="id">HA-25Z7L8-03</div>
            <div><small>Minhaz Uddin Kadir</small></div>
          </div>
          <div class="actions">
            <button class="btn fav-btn" data-id="HA-25Z7L8-03" onclick="toggleFavorite('HA-25Z7L8-03', event)">Favorite</button>
            <button class="btn" onclick="copyToClipboard('HA-25Z7L8-03', event)">Copy</button>
            <button class="btn" onclick="downloadPDF('HA-25Z7L8-03', event)">PDF</button>
          </div>
        </div>

        <div class="card" data-id="HA-25R6P5-04" data-name="Ebrahim Jamal Abdullah">
          <div class="meta">
            <div class="id">HA-25R6P5-04</div>
            <div><small>Ebrahim Jamal Abdullah</small></div>
          </div>
          <div class="actions">
            <button class="btn fav-btn" data-id="HA-25R6P5-04" onclick="toggleFavorite('HA-25R6P5-04', event)">Favorite</button>
            <button class="btn" onclick="copyToClipboard('HA-25R6P5-04', event)">Copy</button>
            <button class="btn" onclick="downloadPDF('HA-25R6P5-04', event)">PDF</button>
          </div>
        </div>
      </div>
    </section>

    <div id="favoritesSection">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2>Favorite Members</h2>
        <div><button class="btn secondary" onclick="goHome()">Back</button></div>
      </div>
      <div id="favList" style="margin-top:12px;"></div>
    </div>

    <div id="dashboard">
      <h2>Member Dashboard</h2>
      <div id="dashContent"></div>
      <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
        <button class="btn" onclick="openTracker()">Open Salah Tracker</button>
        <button class="btn secondary" onclick="logout()">Logout</button>
        <button class="btn secondary" onclick="goHome()">Back</button>
      </div>
    </div>

    <div id="salahTracker">
      <h2>Salah Tracker - October 2025</h2>
      <div class="tracker-wrap">
        <table id="trackerTable">
          <thead>
            <tr><th>Date</th><th>Fajr</th><th>Dhuhr</th><th>Asr</th><th>Maghrib</th><th>Isha</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="summary" id="summaryBox"></div>
      <div style="margin-top:8px;"><button class="btn secondary" onclick="goHome()">Back</button></div>
    </div>

  </main>

  <div id="loginModal">
    <div id="loginBox">
      <h3>Member Login</h3>
      <input type="text" id="loginId" placeholder="Member ID (e.g. HA-25X9Q7-01)">
      <input type="password" id="loginPass" placeholder="Password">
      <div style="display:flex; gap:8px; margin-top:8px;">
        <button class="btn" onclick="login()">Login</button>
        <button class="btn secondary" onclick="closeLogin()">Cancel</button>
      </div>
      <p style="font-size:13px; color:var(--muted); margin-top:8px;">Note: Only 4 fixed members can login. No new registration.</p>
    </div>
  </div>

  <footer>
    <p>Â© HADIQATUL A'DOL 2025 | Developed by Md Amir Hamza</p>
  </footer>

<script>
// ---------- data ----------
const accounts = {
  "HA-25X9Q7-01": {password:"pass1", name:"Md Amir Hamza (Admin)", address:"Johirpur, Chhatak, Sunamgonj"},
  "HA-25K4M2-02": {password:"pass2", name:"Munaim Ahmed Ihfaz", address:"Bade Jhigli, Chhatak, Sunamgonj"},
  "HA-25Z7L8-03": {password:"pass3", name:"Minhaz Uddin Kadir", address:"Bade Jhigli (Kandal Para), Chhatak, Sunamgonj"},
  "HA-25R6P5-04": {password:"pass4", name:"Ebrahim Jamal Abdullah", address:"Boratuka, Chhatak, Sunamgonj"}
};
const data = {
  "HA-25X9Q7-01": {name:"Md Amir Hamza (Admin)", address:"Johirpur, Chhatak, Sunamgonj", id:"HA-25X9Q7-01"},
  "HA-25K4M2-02": {name:"Munaim Ahmed Ihfaz (Member)", address:"Bade Jhigli, Chhatak, Sunamgonj", id:"HA-25K4M2-02"},
  "HA-25Z7L8-03": {name:"Minhaz Uddin Kadir (Member)", address:"Bade Jhigli (Kandal Para), Chhatak, Sunamgonj", id:"HA-25Z7L8-03"},
  "HA-25R6P5-04": {name:"Ebrahim Jamal Abdullah (Member)", address:"Boratuka, Chhatak, Sunamgonj", id:"HA-25R6P5-04"}
};

// ---------- state ----------
let loggedInId = localStorage.getItem('had_logged_in') || null;
let menuOpen = false;

// ---------- init ----------
window.addEventListener('load', ()=>{
  const saved = localStorage.getItem('had_theme');
  if(saved) setTheme(saved);
  initCards();
  updateFavButtons();
  updateMenu();
  // show main
  showSection('home');
});

// ---------- theme ----------
function setTheme(mode){
  document.body.className = mode === 'light' ? '' : mode;
  localStorage.setItem('had_theme', mode);
  document.getElementById('menuOptions').style.display = 'none';
  menuOpen = false;
}

// ---------- menu toggle ----------
function toggleMenu(){
  menuOpen = !menuOpen;
  document.getElementById('menuOptions').style.display = menuOpen ? 'block' : 'none';
}
document.getElementById('menuToggle').addEventListener('click', ()=> toggleMenu());
// close menu clicking outside and also allow same icon click to toggle
document.addEventListener('click', (e)=>{
  if(!e.target.closest('#menuToggle') && !e.target.closest('.menu-options')){
    menuOpen = false;
    document.getElementById('menuOptions').style.display = 'none';
  }
});

// ---------- cards & details ----------
function initCards(){
  document.querySelectorAll('.card').forEach(card=>{
    card.onclick = null;
    card.addEventListener('click', function(e){
      if(e.target.closest('button')) return;
      const existing = this.querySelector('.details');
      if(existing){
        existing.classList.toggle('open');
        return;
      }
      const id = this.getAttribute('data-id');
      const m = data[id];
      const details = document.createElement('div');
      details.className = 'details open';
      details.innerHTML = `<p><strong>Full Name:</strong> ${m.name}</p>
        <p><strong>Address:</strong> ${m.address}</p>
        <p><strong>Member Id:</strong> ${m.id}</p>
        <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn" onclick="copyToClipboard('${m.id}', event)">Copy</button>
          <button class="btn" onclick="downloadPDF('${m.id}', event)">PDF</button>
          <button class="btn secondary" onclick="toggleFavorite('${m.id}', event)">${isFavorited(m.id)? 'Unfavorite':'Favorite'}</button>
        </div>`;
      this.appendChild(details);
    });
  });
}

// ---------- search ----------
document.getElementById('searchInput').addEventListener('input', function(){
  const q = this.value.trim().toLowerCase();
  document.querySelectorAll('.card').forEach(card=>{
    const id = card.dataset.id.toLowerCase();
    const name = (card.dataset.name||'').toLowerCase();
    const show = id.includes(q) || name.includes(q);
    card.style.display = show ? 'flex' : 'none';
  });
});
function performSearch(){ const q=document.getElementById('searchInput').value.trim(); if(!q) return; const key = Object.keys(data).find(k=>k.toLowerCase()===q.toLowerCase()|| data[k].name.toLowerCase()===q.toLowerCase()); if(key){ const c=document.querySelector(`.card[data-id="${key}"]`); if(c){ c.scrollIntoView({behavior:'smooth', block:'center'}); const d=c.querySelector('.details'); if(d) { d.classList.toggle('open'); } else c.click(); }} else alert('No member found for \"'+q+'\"'); }

// ---------- favorites ----------
function isFavorited(id){ const favs = JSON.parse(localStorage.getItem('favorites')||'[]'); return favs.includes(id); }
function toggleFavorite(id,e){ if(e) e.stopPropagation(); let favs = JSON.parse(localStorage.getItem('favorites')||'[]'); const idx=favs.indexOf(id); if(idx===-1){ favs.push(id); alert('Added to Favorites'); } else { favs.splice(idx,1); alert('Removed from Favorites'); } localStorage.setItem('favorites', JSON.stringify(favs)); updateFavButtons(); }
function updateFavButtons(){ const favs = JSON.parse(localStorage.getItem('favorites')||'[]'); document.querySelectorAll('.fav-btn').forEach(btn=>{ const id = btn.getAttribute('data-id'); if(favs.includes(id)){ btn.classList.add('added'); btn.textContent = 'Unfavorite'; } else { btn.classList.remove('added'); btn.textContent = 'Favorite'; } }); }
function showFavorites(){ const favs=JSON.parse(localStorage.getItem('favorites')||'[]'); const favList=document.getElementById('favList'); favList.innerHTML=''; if(favs.length===0){ favList.innerHTML="<p style='color:var(--muted); text-align:center;'>No favorites added.</p>"; } else { favs.forEach(id=>{ const m=data[id]; if(!m) return; const div=document.createElement('div'); div.className='card'; div.innerHTML=`<div class="meta"><div class="id">${m.id}</div><div><small>${m.name}</small></div></div><div class="actions"><button class="btn" onclick="copyToClipboard('${m.id}', event)">Copy</button><button class="btn" onclick="downloadPDF('${m.id}', event)">PDF</button><button class="btn secondary" onclick="removeFavorite('${m.id}', event)">Remove</button></div>`; favList.appendChild(div); }); } showSection('favorites'); document.getElementById('menuOptions').style.display='none'; menuOpen=false; updateFavButtons(); }
function removeFavorite(id,e){ if(e) e.stopPropagation(); let favs=JSON.parse(localStorage.getItem('favorites')||'[]'); favs=favs.filter(f=>f!==id); localStorage.setItem('favorites', JSON.stringify(favs)); showFavorites(); }

// ---------- clipboard & pdf ----------
function copyToClipboard(id,e){ if(e) e.stopPropagation(); const m=data[id]; if(!m) return; const text=`Full Name: ${m.name}\nAddress: ${m.address}\nMember ID: ${m.id}`; navigator.clipboard.writeText(text).then(()=> alert('Copied to clipboard!')).catch(()=> alert('Could not copy to clipboard')); }
async function downloadPDF(id,e){ if(e) e.stopPropagation(); const m=data[id]; if(!m) return; const { jsPDF } = window.jspdf; const doc=new jsPDF({unit:'pt', format:'a4'}); const pageW=doc.internal.pageSize.getWidth(); doc.setFillColor(43,140,255); doc.rect(0,0,pageW,70,'F'); doc.setTextColor(255,255,255); doc.setFontSize(20); doc.setFont('helvetica','bold'); doc.text('HADIQATUL A\\'DOL', pageW/2, 40, {align:'center'}); doc.setDrawColor(200); doc.setFillColor(255,255,255); doc.roundedRect(40,90,pageW-80,220,8,8,'F'); let xLabel=60, xVal=160, y=120; doc.setTextColor(30,30,30); doc.setFont('helvetica','bold'); doc.setFontSize(12); doc.text('Full Name:', xLabel, y); doc.setFont('helvetica','normal'); doc.setFontSize(13); doc.text(m.name, xVal, y); y+=28; doc.setFont('helvetica','bold'); doc.setFontSize(12); doc.text('Address:', xLabel, y); doc.setFont('helvetica','normal'); doc.setFontSize(12); const splitAddr=doc.splitTextToSize(m.address, pageW-xVal-60); doc.text(splitAddr, xVal, y); y += (splitAddr.length*14)+6; doc.setFont('helvetica','bold'); doc.setFontSize(12); doc.text('Member Id:', xLabel, y); doc.setFont('helvetica','normal'); doc.setFontSize(12); doc.text(m.id, xVal, y); doc.setFontSize(9); doc.setTextColor(120); doc.text('Â© HADIQATUL A\\'DOL 2025 | Developed by Md Amir Hamza', pageW/2, doc.internal.pageSize.getHeight()-40, {align:'center'}); doc.save(`${m.id}.pdf`); }
function downloadAllPDF(){ Object.keys(data).forEach((id,i)=> setTimeout(()=> downloadPDF(id,null), i*300)); }

// ---------- navigation state & sections ----------
function showSection(name){ // name: 'home' | 'favorites' | 'dashboard' | 'tracker'
  document.getElementById('mainContent').style.display = name === 'home' ? 'block' : 'none';
  document.getElementById('favoritesSection').style.display = name === 'favorites' ? 'block' : 'none';
  document.getElementById('dashboard').style.display = name === 'dashboard' ? 'block' : 'none';
  document.getElementById('salahTracker').style.display = name === 'tracker' ? 'block' : 'none';
  // manage history so mobile back works
  try{ history.replaceState({page:name}, '', ''); } catch(e) {}
}

// push state for modal/open screens
function pushState(name){ try{ history.pushState({page:name}, '', ''); } catch(e){} }

// handle back button behavior
window.addEventListener('popstate', function(e){
  const s = (e.state && e.state.page) ? e.state.page : null;
  if(s === 'login'){ closeLogin(); updateMenu(); showSection('home'); return; }
  // any pop navigates back to home
  showSection('home');
  updateMenu();
});

// ---------- login/dashboard/tracker ----------
function openLogin(){ document.getElementById('loginModal').style.display='flex'; document.getElementById('loginId').focus(); pushState('login'); }
function closeLogin(){ document.getElementById('loginModal').style.display='none'; try{ history.back(); }catch(e){} }
function login(){ const id = document.getElementById('loginId').value.trim(); const pw = document.getElementById('loginPass').value.trim(); if(!id || !pw){ alert('Enter Member ID and Password'); return; } if(accounts[id] && accounts[id].password === pw){ loggedInId = id; localStorage.setItem('had_logged_in', id); alert('Login successful'); closeLogin(); updateMenu(); openDashboard(); } else { alert('Invalid Member ID or Password'); } }
function logout(){ if(confirm('Logout?')){ loggedInId = null; localStorage.removeItem('had_logged_in'); updateMenu(); showSection('home'); try{ history.replaceState({page:'home'}, '', ''); } catch(e){} } }
function updateMenu(){ if(loggedInId){ document.getElementById('loginBtn').style.display='none'; document.getElementById('dashboardBtn').style.display='block'; } else { document.getElementById('loginBtn').style.display='block'; document.getElementById('dashboardBtn').style.display='none'; } }

function openDashboard(){ if(!loggedInId){ openLogin(); return; } const m = accounts[loggedInId]; document.getElementById('dashContent').innerHTML = `<div style="display:flex; gap:12px; flex-wrap:wrap;"><div style="min-width:220px; flex:1; background:var(--card); padding:12px; border-radius:10px; box-shadow:var(--shadow);"><h3 style="margin:0 0 6px 0;">Profile</h3><p style="margin:6px 0;"><strong>${m.name}</strong></p><p style="margin:6px 0; color:var(--muted);">${loggedInId}</p><p style="margin:6px 0; color:var(--muted);">${m.address}</p></div><div style="min-width:220px; flex:1; background:linear-gradient(180deg, rgba(43,140,255,0.06), rgba(43,140,255,0.02)); padding:12px; border-radius:10px; box-shadow:var(--shadow);"><h3 style="margin:0 0 6px 0;">Quick Stats</h3><div id="quickStats"></div></div></div>`; // compute stats
  const key='salah_'+loggedInId; const saved = JSON.parse(localStorage.getItem(key) || '{}'); let prayed=0, missed=0; for(let d in saved){ for(let p in saved[d]){ if(saved[d][p]===true) prayed++; else missed++; } } const total = 31*5; const pending = total - (prayed+missed); document.getElementById('quickStats').innerHTML = `<p style="margin:6px 0;"><strong>Prayed:</strong> ${prayed}</p><p style="margin:6px 0;"><strong>Missed:</strong> ${missed}</p><p style="margin:6px 0;"><strong>Pending:</strong> ${pending}</p>`; showSection('dashboard'); pushState('dashboard'); }

function onTrackerClick(){ if(!loggedInId){ openLogin(); return; } openTracker(); }
function openTracker(){ openDashboard(); showSection('tracker'); buildTableForUser(loggedInId); pushState('tracker'); }

// ---------- tracker ----------
function buildTableForUser(memberId){ const tbody=document.querySelector('#trackerTable tbody'); tbody.innerHTML=''; const key='salah_'+memberId; const saved = JSON.parse(localStorage.getItem(key) || '{}'); for(let d=1; d<=31; d++){ const tr=document.createElement('tr'); tr.setAttribute('data-day', d); let row=`<td>${d}</td>`; ['Fajr','Dhuhr','Asr','Maghrib','Isha'].forEach(pr=>{ const val = saved[d] && (saved[d][pr] === true ? 'on' : (saved[d][pr] === false ? 'off' : 'none')); const onClass = val === 'on' ? 'on' : ''; const offClass = val === 'off' ? 'off' : ''; row += `<td class="cell-actions"><button class="${onClass}" onclick="mark(${d},'${pr}',true,'${memberId}', event)">Yes</button><button class="${offClass}" onclick="mark(${d},'${pr}',false,'${memberId}', event)">No</button></td>`; }); tr.innerHTML = row; tbody.appendChild(tr); } updateSummaryForUser(memberId); }

function mark(day, prayer, val, memberId, e){ if(e) e.stopPropagation(); const key='salah_'+memberId; const dataObj = JSON.parse(localStorage.getItem(key) || '{}'); if(!dataObj[day]) dataObj[day] = {}; dataObj[day][prayer] = val; localStorage.setItem(key, JSON.stringify(dataObj)); buildTableForUser(memberId); }

function updateSummaryForUser(memberId){ const key='salah_'+memberId; const dataObj = JSON.parse(localStorage.getItem(key) || '{}'); let prayed=0, missed=0, total=31*5; for(let d in dataObj){ for(let p in dataObj[d]){ if(dataObj[d][p]===true) prayed++; else missed++; } } const pending = total - (prayed+missed); document.getElementById('summaryBox').textContent = `Prayed: ${prayed} | Missed: ${missed} | Pending: ${pending}`; document.getElementById('quickStats') && (document.getElementById('quickStats').innerHTML = `<p style="margin:6px 0;"><strong>Prayed:</strong> ${prayed}</p><p style="margin:6px 0;"><strong>Missed:</strong> ${missed}</p><p style="margin:6px 0;"><strong>Pending:</strong> ${pending}</p>`); }

// close login modal when clicking outside
document.getElementById('loginModal').addEventListener('click', function(e){ if(e.target === this) { closeLogin(); } });

// close menu on scroll
window.addEventListener('scroll', ()=>{ document.getElementById('menuOptions').style.display='none'; menuOpen=false; });

</script>
</body>
</html>
