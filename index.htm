<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HADIQATUL A'DOL Members</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root{
      --bg:#f4f6f9; --card:#fff; --text:#222; --accent:#4cafef;
      --muted:#7b7b85; --success:#2e7d32; --danger:#d32f2f;
    }
    body.dark{ --bg:#141418; --card:#1f1f25; --text:#eef; --accent:#6ab4ff; --muted:#9aa0b4 }
    body{ font-family:"Segoe UI", Roboto, Arial, sans-serif; margin:0; background:var(--bg); color:var(--text); transition:background .28s, color .28s; -webkit-font-smoothing:antialiased; }
    header{ display:flex; align-items:center; justify-content:space-between; padding:12px 18px; background:var(--accent); color:#fff; position:sticky; top:0; z-index:50; }
    header h1{ margin:0; font-size:18px; }
    .menu{ font-size:22px; cursor:pointer; user-select:none; }
    .menu-options{ display:none; position:absolute; right:18px; top:60px; background:var(--card); padding:12px; border-radius:10px; box-shadow:0 8px 28px rgba(2,6,23,.14); z-index:80; width:220px; transform-origin:top right; }
    .menu-options.enter{ animation:pop .15s ease; display:block; }
    @keyframes pop{ from{ transform:scale(.96); opacity:0 } to{ transform:scale(1); opacity:1 } }
    .menu-options .theme-title{ font-weight:600; margin-bottom:8px; color:var(--text); }
    .swatches{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px; }
    .swatch{ width:28px; height:28px; border-radius:6px; cursor:pointer; border:2px solid rgba(255,255,255,0.35); box-shadow:0 2px 6px rgba(0,0,0,.06); }
    .menu-options button{ display:block; width:100%; padding:8px 10px; margin-top:8px; border-radius:8px; border:none; background:var(--accent); color:white; cursor:pointer; }

    .container{ max-width:960px; margin:26px auto; padding:16px; }
    .search-box{ display:flex; gap:8px; justify-content:center; margin-bottom:18px; }
    .search-box input{ width:70%; padding:10px 12px; border-radius:8px; border:1px solid #ccc; outline: none; transition:box-shadow .18s; }
    .search-box input:focus{ box-shadow:0 6px 18px rgba(76,175,239,.12) }
    .search-box button{ padding:10px 14px; border-radius:8px; border:none; background:var(--accent); color:#fff; cursor:pointer; }

    h2{ color:var(--accent); margin-top:26px; margin-bottom:8px; }
    .list{ margin-top:8px; }
    .card{ background:var(--card); border-radius:10px; padding:12px; margin:8px 0; box-shadow:0 6px 18px rgba(12,15,20,.04); transition:transform .18s, background .18s; cursor:pointer; }
    .card:hover{ transform:translateY(-4px) }
    .card .id{ font-weight:700; color:var(--text); }
    .details{ display:none; margin-top:8px; padding:10px; border-left:4px solid var(--accent); border-radius:6px; background:rgba(0,0,0,0.02); }
    .details p{ margin:6px 0; }
    .details .actions{ margin-top:8px; display:flex; gap:8px; flex-wrap:wrap; }
    .btn{ padding:8px 10px; border:none; border-radius:8px; cursor:pointer; background:var(--accent); color:#fff; }
    .btn.secondary{ background:#666; }
    .fav-btn.added{ background:#ffb703; color:#000; }

    footer{ text-align:center; padding:16px; margin-top:26px; background:var(--card); border-top:3px solid var(--accent); }

    /* Favorites section hidden by default */
    #favoritesSection{ display:none; }

    /* Login modal */
    .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; z-index:200; }
    .modal{ width:360px; max-width:94%; background:var(--card); border-radius:12px; padding:16px; box-shadow:0 18px 50px rgba(2,6,23,.28); transform:translateY(10px); opacity:0; transition:all .18s; }
    .modal.show{ transform:translateY(0); opacity:1; }
    .modal h3{ margin:0 0 8px 0; color:var(--text); }
    .field{ margin:8px 0; display:flex; flex-direction:column; gap:6px; }
    .field input{ padding:10px; border-radius:8px; border:1px solid #ddd; outline:none; }
    .small{ font-size:13px; color:var(--muted); }

    /* Dashboard / Descode */
    .descode{ display:none; padding:12px; animation:fadeIn .2s ease; background:linear-gradient(180deg, rgba(74,175,239,.06), rgba(255,255,255,0)); border-radius:10px; }
    @keyframes fadeIn{ from{ opacity:0; transform:translateY(6px)} to{ opacity:1; transform:none} }

    /* Salat Tracker */
    .tracker{ display:none; margin-top:10px; }
    .tracker .controls{ display:flex; gap:8px; align-items:center; justify-content:space-between; margin-bottom:10px; }
    .month-title{ font-weight:700; }
    .calendar{ display:grid; grid-template-columns: repeat(7, 1fr); gap:8px; }
    .day{ background:var(--card); border-radius:10px; padding:8px; box-shadow:0 8px 20px rgba(2,6,23,.04); min-height:120px; display:flex; flex-direction:column; gap:6px; transition:transform .12s; }
    .day:hover{ transform:translateY(-4px) }
    .dateRow{ display:flex; justify-content:space-between; align-items:center; gap:6px; }
    .dateCircle{ width:36px; height:36px; border-radius:50%; background:linear-gradient(180deg,#fff,#f1f6ff); display:flex; align-items:center; justify-content:center; font-weight:700; box-shadow:0 6px 14px rgba(76,175,239,.08); }
    .prayers{ display:flex; flex-direction:column; gap:6px; margin-top:6px; }
    .prayerRow{ display:flex; align-items:center; justify-content:space-between; gap:6px; font-size:13px; }
    .prayerBtns{ display:flex; gap:6px; }
    .toggleBtn{ width:34px; height:28px; border-radius:6px; border:1px solid #ddd; display:flex; align-items:center; justify-content:center; cursor:pointer; background:#fff; transition:transform .08s; }
    .toggleBtn:active{ transform:scale(.98) }
    .status-done{ background:#e6f4ea; border-color:var(--success); color:var(--success) }
    .status-miss{ background:#fdecea; border-color:var(--danger); color:var(--danger) }
    .summary{ margin-top:12px; padding:10px; border-radius:8px; background:var(--card); box-shadow:0 8px 20px rgba(2,6,23,.03); display:flex; gap:12px; justify-content:space-between; align-items:center; }

    /* responsive */
    @media (max-width:880px){
      .calendar{ grid-template-columns: repeat(3, 1fr); }
    }
    @media (max-width:520px){
      .calendar{ grid-template-columns: repeat(2, 1fr); }
      .dateCircle{ width:28px; height:28px; font-size:13px }
    }

  </style>
</head>
<body>
  <header>
    <h1>HADIQATUL A'DOL Members</h1>
    <div style="position:relative;">
      <div class="menu" onclick="toggleMenu()">‚ò∞</div>
      <div class="menu-options" id="menuOptions" aria-hidden="true">
        <div class="theme-title">Choose Theme</div>
        <div class="swatches" style="margin-bottom:8px;">
          <div class="swatch" title="Light" style="background:#f4f6f9" onclick="setTheme('light')"></div>
          <div class="swatch" title="Dark" style="background:#1e1e2f" onclick="setTheme('dark')"></div>
          <div class="swatch" title="Green" style="background:#4caf50" onclick="setTheme('green')"></div>
          <div class="swatch" title="Purple" style="background:#9c27b0" onclick="setTheme('purple')"></div>
          <div class="swatch" title="Blue" style="background:#3b82f6" onclick="setTheme('blue')"></div>
          <div class="swatch" title="Orange" style="background:#fb923c" onclick="setTheme('orange')"></div>
        </div>
        <button onclick="showFavorites()">View Favorites ‚≠ê</button>
        <div style="height:8px"></div>
        <div id="authButtonsArea">
          <!-- dynamic auth buttons inserted here -->
          <button class="btn" id="loginBtn" onclick="openLogin()">Login üîê</button>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- MAIN CONTENT (original preserved) -->
    <div id="mainContent">
      <div class="search-box">
        <input id="searchInput" type="text" placeholder="Search by ID or name (type to filter)">
        <button onclick="performSearch()">Search</button>
      </div>

      <section>
        <h2>Admin</h2>
        <div class="list" id="adminList">
          <div class="card" data-id="HA-25X9Q7-01" data-name="Md Amir Hamza">
            <div class="id">HA-25X9Q7-01</div>
            <div class="details">
              <p><strong>Full Name:</strong> Md Amir Hamza (Admin)</p>
              <p><strong>Address:</strong> Johirpur, Chhatak, Sunamgonj</p>
              <p><strong>Member Id:</strong> HA-25X9Q7-01</p>
              <div class="actions">
                <button class="btn fav-btn" data-id="HA-25X9Q7-01" onclick="toggleFavorite('HA-25X9Q7-01', event)">‚≠ê Favorite</button>
                <button class="btn" onclick="copyToClipboard('HA-25X9Q7-01', event)">üìã Copy</button>
                <button class="btn" onclick="downloadPDF('HA-25X9Q7-01', event)">üìë PDF</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section>
        <h2>Members</h2>
        <div class="list" id="memberList">
          <div class="card" data-id="HA-25K4M2-02" data-name="Munaim Ahmed Ihfaz">
            <div class="id">HA-25K4M2-02</div>
            <div class="details">
              <p><strong>Full Name:</strong> Munaim Ahmed Ihfaz (Member)</p>
              <p><strong>Address:</strong> Bade Jhigli, Chhatak, Sunamgonj</p>
              <p><strong>Member Id:</strong> HA-25K4M2-02</p>
              <div class="actions">
                <button class="btn fav-btn" data-id="HA-25K4M2-02" onclick="toggleFavorite('HA-25K4M2-02', event)">‚≠ê Favorite</button>
                <button class="btn" onclick="copyToClipboard('HA-25K4M2-02', event)">üìã Copy</button>
                <button class="btn" onclick="downloadPDF('HA-25K4M2-02', event)">üìë PDF</button>
              </div>
            </div>
          </div>

          <div class="card" data-id="HA-25Z7L8-03" data-name="Minhaz Uddin Kadir">
            <div class="id">HA-25Z7L8-03</div>
            <div class="details">
              <p><strong>Full Name:</strong> Minhaz Uddin Kadir (Member)</p>
              <p><strong>Address:</strong> Bade Jhigli (Kandal Para), Chhatak, Sunamgonj</p>
              <p><strong>Member Id:</strong> HA-25Z7L8-03</p>
              <div class="actions">
                <button class="btn fav-btn" data-id="HA-25Z7L8-03" onclick="toggleFavorite('HA-25Z7L8-03', event)">‚≠ê Favorite</button>
                <button class="btn" onclick="copyToClipboard('HA-25Z7L8-03', event)">üìã Copy</button>
                <button class="btn" onclick="downloadPDF('HA-25Z7L8-03', event)">üìë PDF</button>
              </div>
            </div>
          </div>

          <div class="card" data-id="HA-25R6P5-04" data-name="Ebrahim Jamal Abdullah">
            <div class="id">HA-25R6P5-04</div>
            <div class="details">
              <p><strong>Full Name:</strong> Ebrahim Jamal Abdullah (Member)</p>
              <p><strong>Address:</strong> Boratuka, Chhatak, Sunamgonj</p>
              <p><strong>Member Id:</strong> HA-25R6P5-04</p>
              <div class="actions">
                <button class="btn fav-btn" data-id="HA-25R6P5-04" onclick="toggleFavorite('HA-25R6P5-04', event)">‚≠ê Favorite</button>
                <button class="btn" onclick="copyToClipboard('HA-25R6P5-04', event)">üìã Copy</button>
                <button class="btn" onclick="downloadPDF('HA-25R6P5-04', event)">üìë PDF</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- DESCODE (dashboard) -->
      <div id="descodeSection" class="descode" style="margin-top:18px;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <h2>Descode Dashboard</h2>
          <div id="descodeActions"></div>
        </div>
        <p class="small" id="descodeWelcome">(Login to view personalized dashboard)</p>
        <div style="display:flex; gap:12px; margin-top:12px; flex-wrap:wrap;">
          <div style="min-width:220px; padding:12px; border-radius:8px; background:var(--card); box-shadow:0 8px 20px rgba(2,6,23,.03);">
            <div style="font-size:24px; font-weight:700;" id="dashboardMember">‚Äî</div>
            <div class="small">Member ID</div>
          </div>
          <div style="min-width:220px; padding:12px; border-radius:8px; background:var(--card); box-shadow:0 8px 20px rgba(2,6,23,.03);">
            <div style="font-size:24px; font-weight:700;" id="dashboardLoginAt">‚Äî</div>
            <div class="small">Last login</div>
          </div>
          <div style="min-width:220px; padding:12px; border-radius:8px; background:var(--card); box-shadow:0 8px 20px rgba(2,6,23,.03);">
            <div style="font-size:24px; font-weight:700;" id="dashboardStats">‚Äî</div>
            <div class="small">Salat progress (Oct)</div>
          </div>
        </div>
      </div>

      <!-- Salat Tracker -->
      <div id="trackerSection" class="tracker">
        <div class="controls">
          <div>
            <div class="month-title">‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞ (October)</div>
            <div class="small">‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡ß´ ‡¶ì‡ßü‡¶æ‡¶ï‡ßç‡¶§: Fajr, Dhuhr, Asr, Maghrib, Isha</div>
          </div>
          <div>
            <button class="btn" onclick="markAllThisMonth('done')">Mark all done</button>
            <button class="btn secondary" onclick="markAllThisMonth('clear')">Clear month</button>
          </div>
        </div>

        <div id="trackerGrid" class="calendar" aria-live="polite"></div>

        <div class="summary" id="trackerSummary">
          <div>
            <div style="font-weight:700" id="totalDone">Done: 0</div>
            <div class="small" id="totalMiss">Missed: 0</div>
          </div>
          <div style="text-align:right">
            <div style="font-weight:700" id="totalRemain">Remaining: 0</div>
            <div class="small">Out of <span id="totalPossible">0</span> (31 days √ó 5)</div>
          </div>
        </div>
      </div>

      <!-- FAVORITES (hidden, toggled) -->
      <div id="favoritesSection">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <h2>‚≠ê Favorite Members</h2>
          <div>
            <button class="btn secondary" onclick="goHome()">üè† Back</button>
          </div>
        </div>
        <div id="favList" style="margin-top:12px;"></div>
      </div>

    </div>
  </main>

  <footer>
    <p>¬© HADIQATUL A'DOL 2025 | Developed by Md Amir Hamza</p>
  </footer>

  <!-- LOGIN MODAL -->
  <div class="modal-backdrop" id="modalBackdrop" onclick="closeLogin(event)">
    <div class="modal" id="loginModal" onclick="event.stopPropagation()">
      <h3>Member Login</h3>
      <div class="field">
        <label class="small">Member ID</label>
        <input id="loginId" placeholder="HA-25X9Q7-01" />
      </div>
      <div class="field">
        <label class="small">Password</label>
        <input id="loginPass" type="password" placeholder="Password"/>
      </div>
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:8px;">
        <button class="btn secondary" onclick="closeLogin()">Cancel</button>
        <button class="btn" onclick="doLogin()">Login</button>
      </div>
      <p class="small" style="margin-top:8px">‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®/‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶≤‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶ï‡ßá ‡¶ú‡¶æ‡¶®‡¶æ‡¶®‡•§</p>
    </div>
  </div>

<script>
/* ---------------------------
   Data & initial config
   --------------------------- */
const data = {
  "HA-25X9Q7-01": {name:"Md Amir Hamza (Admin)", address:"Johirpur, Chhatak, Sunamgonj", id:"HA-25X9Q7-01"},
  "HA-25K4M2-02": {name:"Munaim Ahmed Ihfaz (Member)", address:"Bade Jhigli, Chhatak, Sunamgonj", id:"HA-25K4M2-02"},
  "HA-25Z7L8-03": {name:"Minhaz Uddin Kadir (Member)", address:"Bade Jhigli (Kandal Para), Chhatak, Sunamgonj", id:"HA-25Z7L8-03"},
  "HA-25R6P5-04": {name:"Ebrahim Jamal Abdullah (Member)", address:"Boratuka, Chhatak, Sunamgonj", id:"HA-25R6P5-04"}
};

// AUTH: fixed credentials (client-side)
const credentials = {
  "HA-25X9Q7-01": "Hamza@2025#",
  "HA-25K4M2-02": "Ihfaz!2025*",
  "HA-25Z7L8-03": "Minhaz#25@",
  "HA-25R6P5-04": "Ebrahim*123$"
};

// tracker config
const DAYS_IN_OCT = 31;
const PRAYERS = ["Fajr","Dhuhr","Asr","Maghrib","Isha"];
const STORAGE_KEY_PREFIX = "htad_salat_"; // will append member id

/* ---------------------------
   UI helpers & init
   --------------------------- */
function toggleMenu(){
  const m = document.getElementById('menuOptions');
  if(m.style.display === 'block'){ m.style.display='none' }
  else { m.style.display='block'; m.classList.add('enter') }
}

function setTheme(mode){
  document.body.className = mode === 'light' ? '' : mode;
  localStorage.setItem('had_theme', mode);
  document.getElementById('menuOptions').style.display = 'none';
}

window.addEventListener('load', ()=>{
  const saved = localStorage.getItem('had_theme'); if(saved) setTheme(saved);
  initCards(); updateFavButtons(); renderAuthButtons();
  // check if already logged in
  const current = getCurrentUser();
  if(current){ showDescodeFor(current); }
});

/* Card interactions */
function initCards(){
  document.querySelectorAll('.card').forEach(card=>{
    const id = card.getAttribute('data-id');
    card.addEventListener('click', (e)=>{
      if(e.target.closest('button')) return;
      const details = card.querySelector('.details');
      details.style.display = details.style.display === 'block' ? 'none' : 'block';
    });
  });
}

/* SEARCH */
document.getElementById('searchInput').addEventListener('input', function(){
  const q = this.value.trim().toLowerCase();
  document.querySelectorAll('.card').forEach(card=>{
    const id = card.dataset.id.toLowerCase();
    const name = card.dataset.name.toLowerCase();
    const show = id.includes(q) || name.includes(q);
    card.style.display = show ? 'block' : 'none';
  });
});

function performSearch(){
  const q = document.getElementById('searchInput').value.trim();
  if(!q) return;
  const key = Object.keys(data).find(k => k.toLowerCase() === q.toLowerCase() || data[k].name.toLowerCase() === q.toLowerCase());
  if(key){
    const card = document.querySelector(`.card[data-id="${key}"]`);
    if(card){ card.scrollIntoView({behavior:'smooth', block:'center'}); card.querySelector('.details').style.display='block'; }
  } else {
    alert('No member found for "'+q+'"');
  }
}

/* FAVORITES */
function toggleFavorite(id, e){
  if(e) e.stopPropagation();
  let favs = JSON.parse(localStorage.getItem('favorites') || '[]');
  const idx = favs.indexOf(id);
  if(idx === -1){ favs.push(id); alert('‚≠ê Added to Favorites'); } else { favs.splice(idx,1); alert('‚ùå Removed from Favorites'); }
  localStorage.setItem('favorites', JSON.stringify(favs));
  updateFavButtons();
}
function updateFavButtons(){
  const favs = JSON.parse(localStorage.getItem('favorites') || '[]');
  document.querySelectorAll('.fav-btn').forEach(btn=>{
    const id = btn.getAttribute('data-id');
    if(favs.includes(id)){ btn.classList.add('added'); btn.textContent = '‚ûñ Unfavorite'; }
    else { btn.classList.remove('added'); btn.textContent = '‚≠ê Favorite'; }
  });
}
function showFavorites(){
  const favs = JSON.parse(localStorage.getItem('favorites') || '[]');
  const favList = document.getElementById('favList'); favList.innerHTML = '';
  if(favs.length === 0){ favList.innerHTML = "<p style='color:gray;text-align:center'>No favorites added.</p>"; }
  else {
    favs.forEach(id=>{
      const m = data[id]; if(!m) return;
      const div = document.createElement('div'); div.className='card';
      div.innerHTML = `<div class="id">${m.id}</div><div class="details" style="display:block">
            <p><strong>Full Name:</strong> ${m.name}</p>
            <p><strong>Address:</strong> ${m.address}</p>
            <p><strong>Member Id:</strong> ${m.id}</p>
            <div class="actions">
              <button class="btn" onclick="copyToClipboard('${m.id}', event)">üìã Copy</button>
              <button class="btn" onclick="downloadPDF('${m.id}', event)">üìë PDF</button>
              <button class="btn" onclick="downloadPDF('${m.id}', event)">üìë PDF</button>
              <button class="btn secondary" onclick="removeFavorite('${m.id}', event)">‚ùå Remove</button>
            </div></div>`;
      favList.appendChild(div);
    });
  }
  document.getElementById('mainContent').style.display='none';
  document.getElementById('favoritesSection').style.display='block';
  document.getElementById('menuOptions').style.display='none';
  updateFavButtons();
}
function removeFavorite(id,e){ if(e) e.stopPropagation(); let favs = JSON.parse(localStorage.getItem('favorites') || '[]'); favs = favs.filter(f=> f !== id); localStorage.setItem('favorites', JSON.stringify(favs)); showFavorites(); }
function goHome(){ document.getElementById('favoritesSection').style.display='none'; document.getElementById('mainContent').style.display='block'; document.getElementById('menuOptions').style.display='none'; updateFavButtons(); }

/* COPY & PDF (same as before) */
function copyToClipboard(id, e){
  if(e) e.stopPropagation();
  const m = data[id]; if(!m) return;
  const text = `Full Name: ${m.name}\nAddress: ${m.address}\nMember ID: ${m.id}`;
  navigator.clipboard.writeText(text).then(()=> alert('Copied to clipboard!')).catch(()=> alert('Could not copy'));
}
async function downloadPDF(id, e){
  if(e) e.stopPropagation();
  const m = data[id];
  if(!m){ alert('Member not found'); return; }
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({unit:'pt', format:'a4'});
  const pageW = doc.internal.pageSize.getWidth();
  doc.setFillColor(76,175,239); doc.rect(0,0,pageW,70,'F');
  doc.setTextColor(255,255,255); doc.setFontSize(20); doc.setFont('helvetica','bold');
  doc.text("HADIQATUL A'DOL", pageW/2, 40, {align:'center'});
  doc.setFillColor(255,255,255); doc.roundedRect(40,90,pageW-80,220,8,8,'F');
  let xLabel=60, xVal=160, y=120;
  doc.setTextColor(30,30,30); doc.setFont('helvetica','bold'); doc.setFontSize(12);
  doc.text('Full Name:', xLabel, y); doc.setFont('helvetica','normal'); doc.setFontSize(13);
  doc.text(m.name, xVal, y); y+=28;
  doc.setFont('helvetica','bold'); doc.setFontSize(12); doc.text('Address:', xLabel, y);
  doc.setFont('helvetica','normal'); doc.setFontSize(12);
  const splitAddr = doc.splitTextToSize(m.address, pageW - xVal - 60); doc.text(splitAddr, xVal, y);
  y += (splitAddr.length * 14) + 6;
  doc.setFont('helvetica','bold'); doc.setFontSize(12); doc.text('Member Id:', xLabel, y);
  doc.setFont('helvetica','normal'); doc.setFontSize(12); doc.text(m.id, xVal, y);
  doc.setFontSize(9); doc.setTextColor(120);
  doc.text("¬© HADIQATUL A'DOL 2025 | Developed by Md Amir Hamza", pageW/2, doc.internal.pageSize.getHeight()-40, {align:'center'});
  doc.save(`${m.id}.pdf`);
}

/* ---------------------------
   AUTH (client-side)
   --------------------------- */
function openLogin(){
  document.getElementById('modalBackdrop').style.display='flex';
  setTimeout(()=> document.getElementById('loginModal').classList.add('show'), 10);
  document.getElementById('loginId').value = '';
  document.getElementById('loginPass').value = '';
}

function closeLogin(e){
  if(e && e.target && e.target.id !== 'modalBackdrop') return;
  document.getElementById('loginModal').classList.remove('show');
  setTimeout(()=> document.getElementById('modalBackdrop').style.display='none', 180);
}

function doLogin(){
  const id = document.getElementById('loginId').value.trim();
  const pass = document.getElementById('loginPass').value;
  if(!id || !pass){ alert('‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®'); return; }
  if(!credentials[id]){ alert('Member ID ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡ßü'); return; }
  if(credentials[id] !== pass){ alert('Password ‡¶≠‡ßÅ‡¶≤'); return; }
  // success
  const now = new Date().toISOString();
  const session = { id, at: now };
  localStorage.setItem('htad_session', JSON.stringify(session));
  localStorage.setItem('htad_lastlogin_'+id, now);
  closeLogin();
  renderAuthButtons();
  alert('Logged in as ' + id);
  showDescodeFor(id);
}

function doLogout(){
  localStorage.removeItem('htad_session');
  renderAuthButtons();
  hideDescodeAndTracker();
  alert('Logged out');
}

function getCurrentUser(){
  try{ return JSON.parse(localStorage.getItem('htad_session'))?.id || null; } catch(e){ return null; }
}

function renderAuthButtons(){
  const area = document.getElementById('authButtonsArea'); area.innerHTML = '';
  const current = getCurrentUser();
  if(current){
    area.innerHTML = `<button class="btn" onclick="openDescode()">Descode</button>
                      <button class="btn" onclick="openTracker()">Salat Tracker</button>
                      <button class="btn secondary" onclick="doLogout()">Logout</button>`;
  } else {
    area.innerHTML = `<button class="btn" id="loginBtn" onclick="openLogin()">Login üîê</button>`;
  }
  document.getElementById('menuOptions').style.display='none';
}

/* show Descode */
function openDescode(){
  const u = getCurrentUser();
  if(!u){ openLogin(); return; }
  showDescodeFor(u);
}
function showDescodeFor(id){
  document.getElementById('descodeSection').style.display = 'block';
  document.getElementById('trackerSection').style.display = 'none';
  document.getElementById('mainContent').scrollIntoView({behavior:'smooth'});
  document.getElementById('descodeWelcome').textContent = '‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ, ' + (data[id]?.name || id);
  document.getElementById('dashboardMember').textContent = id;
  document.getElementById('dashboardLoginAt').textContent = (localStorage.getItem('htad_lastlogin_'+id) || '‚Äî').replace('T',' ').slice(0,19);
  updateDashboardStats(id);
}
function hideDescodeAndTracker(){
  document.getElementById('descodeSection').style.display='none';
  document.getElementById('trackerSection').style.display='none';
}

/* SALAT TRACKER */
function openTracker(){
  const u = getCurrentUser();
  if(!u){ openLogin(); return; }
  document.getElementById('descodeSection').style.display='none';
  document.getElementById('trackerSection').style.display='block';
  document.getElementById('mainContent').scrollIntoView({behavior:'smooth'});
  buildTrackerGrid(u);
  updateSummary(u);
}
const PRAYERS = ["Fajr","Dhuhr","Asr","Maghrib","Isha"];
const DAYS_IN_OCT = 31;
const STORAGE_KEY_PREFIX = "htad_salat_";
function buildTrackerGrid(memberId){ /* ... same as ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶ï‡ßã‡¶° */ }
function updateSummary(memberId){ /* ... */ }
function markAllThisMonth(cmd){ /* ... */ }
function updateDashboardStats(memberId){ /* ... */ }

/* close menu on outside click */
document.addEventListener('click', (e)=>{
  const menu = document.getElementById('menuOptions');
  if(!e.target.closest('.menu') && !e.target.closest('.menu-options')){ menu.style.display='none'; }
});
document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeLogin(); });
</script>
